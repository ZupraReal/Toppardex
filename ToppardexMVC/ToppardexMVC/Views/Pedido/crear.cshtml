@using Topardex
@model Pedido

@{
    ViewData["Title"] = "Nuevo Pedido";
}

<h1 class="mb-4">Nuevo Pedido</h1>

<form asp-action="Crear" method="post" class="card p-4 shadow-sm" id="formPedido">
    <div class="mb-3">
        <label class="form-label">ID Cliente</label>
        <input asp-for="IdCliente" class="form-control" required />
        <span asp-validation-for="IdCliente" class="text-danger"></span>
    </div>

    <h5>Productos</h5>
    <table class="table" id="tablaProductos">
        <thead>
            <tr>
                <th>Producto</th>
                <th>Cantidad</th>
                <th>Precio Unitario</th>
                <th>Acci√≥n</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    <select name="Productos[0].IdProducto" class="form-select" required>
                        <option value="">-- Seleccionar --</option>
                        @foreach (var p in (IEnumerable<Producto>)ViewBag.Productos)
                        {
                            <option value="@p.IdProducto">@p.Nombre</option>
                        }
                    </select>
                </td>
                <td><input type="number" name="Productos[0].Cantidad" class="form-control" min="1" value="1" required /></td>
                <td><input type="number" name="Productos[0].PrecioUnitario" class="form-control" step="0.01" min="0" required /></td>
                <td><button type="button" class="btn btn-danger btn-sm" onclick="eliminarFila(this)">X</button></td>
            </tr>
        </tbody>
    </table>

    <button type="button" class="btn btn-secondary mb-3" id="btnAgregar">Agregar Producto</button>

    <button type="submit" class="btn btn-primary">Guardar Pedido</button>
    <a href="/Pedido" class="btn btn-secondary ms-2">Cancelar</a>
</form>

@section Scripts {
<script>
let contador = 1;
document.getElementById('btnAgregar').addEventListener('click', function() {
    const tabla = document.getElementById('tablaProductos').getElementsByTagName('tbody')[0];
    const nuevaFila = document.createElement('tr');
    nuevaFila.innerHTML = `
        <td>
            <select name="Productos[${contador}].IdProducto" class="form-select" required>
                <option value="">-- Seleccionar --</option>
                @foreach (var p in (IEnumerable<Producto>)ViewBag.Productos)
                {
                    <option value="@p.IdProducto">@p.Nombre</option>
                }
            </select>
        </td>
        <td><input type="number" name="Productos[${contador}].Cantidad" class="form-control" min="1" value="1" required /></td>
        <td><input type="number" name="Productos[${contador}].PrecioUnitario" class="form-control" step="0.01" min="0" required /></td>
        <td><button type="button" class="btn btn-danger btn-sm" onclick="eliminarFila(this)">X</button></td>
    `;
    tabla.appendChild(nuevaFila);
    contador++;
});

function eliminarFila(btn) {
    btn.closest('tr').remove();
}
</script>
}
